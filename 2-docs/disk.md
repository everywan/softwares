- [硬盘](#%E7%A1%AC%E7%9B%98)
  - [分区](#%E5%88%86%E5%8C%BA)
    - [fdisk](#fdisk)
    - [格式化](#%E6%A0%BC%E5%BC%8F%E5%8C%96)
    - [分区挂载](#%E5%88%86%E5%8C%BA%E6%8C%82%E8%BD%BD)
    - [分区扩容](#%E5%88%86%E5%8C%BA%E6%89%A9%E5%AE%B9)

# 硬盘
1. 硬盘接口协议
    - IDE并行接口: `/dev/hd[a-z]`, hdc表示光驱设备
    - SATA串行端口: `/dev/sd[a-z]`,  其他 SCSI, SAS, SATA, USB 等也被识别为 `/dev/sd[a-z]`
2. 分区:
    - 一块硬盘上 主分区+扩展分区 的个数最多为4个, 其中的逻辑分区可以创建N个逻辑分区

Linux 下一般使用 ported/fdisk 对磁盘进行操作.

## 分区
### fdisk
1. 'fdisk -l'： 查看所有的硬盘设备
    - 'fdisk -l /dev/sda` : 查看特定设备
2. `fdisk /dev/sda`: 对`/dev/sda`硬盘进行操作(可以是分区, 也可以是整块硬盘)
    - 根据选项解释进行操作即可
    - p: 打印分区表,   n: 新建分区,  l: 列出已知分区类型列表,  t: 更改分区类型,  d: 删除分区
    - w: 保存&&退出,    q: 不保存&&退出
3. 分区完成后内核并不能立即识别分区的信息, 需要以下操作
    - `cat /proc/partitions`: 查看内核识别的分区信息
    - `partprobe /dev/sda | partx -a /dev/sda1 /dev/sda`: 让内核重新读取硬件分区表

### 格式化
划分好分区后, 还需要格式化为相应格式的文件系统才能被系统读写.
1. `mkfs -t ext4  /dev/sda1`: 将 `/dev/sda1` 格式化为 ext4 类型分区
    - `-b`: 指定块的大小, 可取值`{1024|2048|4096byte}`. 块大小取决cpu对内存页框大小的支持, x86系统默认页大小是4096==4k
    - `-L`: label 设定卷标
    - `-m`: 预留给管理使用的块所占的比率. 一般用在分区很大的时候
2. 有兴趣/时间可以研究下 `mke2fs && tune2fs`
    - tune2fs: 查看分区的详细信息

### 分区挂载 
> 如果挂载目录里有内容, 那么挂载硬盘后将会显示硬盘里的内容. 原目录内容只有在umount后才显示

1. mount 挂载命令, 格式: `mount <操作> <挂载点> [<目标>]`
    ```Bash
    fdsik -l  # 查看挂载的硬盘
    mkdir /data1  # 创建挂载点
    mount /dev/sda1 /data1 # 挂载
    ```
2. umount 卸载
    - `umount /dev/sda1`: 卸载
    - `umount -l /dev/sda1`: 采用lazy模式卸载
        - 立即从目录结构中实现卸载, 即新进程将无法通过/data1访问/dev/sda1
        - 正在访问该文件系统的程序不受影响. 即正在操作/data1的进程不会被打断, 且仍可以读写/dev/sda1中的所有文件. 
        - 如果所有进程对/data1的操作都执行完, 那么才真正地umount
        - lazy umount并没有真正实现umount, 仅用于特殊需要的情况, 而用这种方法来卸载U盘是不安全的
3. fuser 查找使用挂载点的程序,kill后可卸载外设
    ```Bash
    fuser -m /data1
    kill id
    ```
4. `df -hl`: 查看是否挂载成功

开机挂载硬盘: Linux 启动时会读取 `/etc/fstab` 文件, 决定挂载哪些分区, 且以何种方式/优先级挂载. 配置文件示例如下

|file system|   mount point|   type|  options|  dump|  pass|
|:----:|:----:|:----:|:----:|:----:|:----:|
a:设备名   |b:文件系统挂载点  |c: 文件系统类型  |d:mount命令选项    |e:转储文件系统   |f：文件系统检查
/dev/sda1   |/data  |ext4  |rw    |0   |2

各列解释如下
1. d: mount命令选项. mount选项包括noauto(不挂载), ro(只读挂载), rw(读写挂载). 在该字段里添加用户或属主选项, 即可允许该用户挂载文件系统. 多个选项之间必须用逗号隔开. 其他选项的相关信息可参看mount命令手册页（-o选项处）
2. e: 转储文件系统. 该字段只在用dump备份时才有意义. 数字1表示该文件系统需要转储, 0表示不需要转储
3. f: 文件系统检查. 该字段里的数字表示文件系统是否需要用fsck检查. 0表示不必检查该文件系统, 数字1示意该文件系统需要先行检查（用于根文件系统）. 数字2则表示完成根文件系统检查后, 再检查该文件系统

### 分区扩容
分区扩容有两种方式:
1. 在原分区的位置上追加空间
   1. 扩容当前分区: `fdisk /dev/sda`, 删掉要扩容的分区, 在 **原起始位置** 创建新分区, 并指定大小.
   2. 执行 `resize2fs /dev/sda3` 使变化生效.
2. 移动整个分区到更大的空间

其实跟编程语言中对向量/切片等可变数组的处理是类似的.